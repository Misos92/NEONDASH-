
import { LevelData, EntityType, GameMode } from '../types';

const createLevel = (
    id: number, 
    name: string, 
    difficulty: string, 
    speed: number, 
    color: string, 
    pattern: string,
    mode: GameMode = 'CUBE'
): LevelData => {
  const entities = [];
  let x = 10; // Start offset

  // The pattern string is read top-to-bottom.
  // The last row of the string corresponds to y=0 (on the floor).
  
  const rows = pattern.trim().split('\n');
  const height = rows.length;

  for (let c = 0; c < rows[0].length; c++) {
    for (let r = 0; r < height; r++) {
       // Invert Y: The last row index (height-1) is world y=0
       const char = rows[r][c];
       const worldY = height - 1 - r; 
       
       if (char === '#') {
         entities.push({ id: Math.random(), type: EntityType.BLOCK, x: x + c, y: worldY });
       } else if (char === '^') {
         entities.push({ id: Math.random(), type: EntityType.SPIKE, x: x + c, y: worldY });
       } else if (char === '@') {
         // Portal entity
         entities.push({ id: Math.random(), type: EntityType.PORTAL, x: x + c, y: worldY });
       }
    }
  }

  return {
    id,
    name,
    difficulty,
    speed,
    color,
    mode,
    entities: entities.sort((a, b) => a.x - b.x),
    length: x + rows[0].length + 20
  };
};

// Level Design Guidelines:
// - Max jump height is approx 3.5 blocks.
// - Max jump distance depends on speed.
// - WALLS: Never place 3 '#' vertically without steps leading up to it.
// - Max vertical wall height = 2 blocks.
// - @ = END LEVEL PORTAL

const level1Pattern = `
..................................................................................................................................................................................................................................................................................................................................................................................................................
..................................................................................................................................................................................................................................................................................................................................................................................................................
..................................................................................................................................................................................................................................................................................................................................................................................................................
..................................................................................................................................................................................................................................................................................................................................................................................................................
......................................................................................................................................................................................................................................................................................................................................................................................................@...........
......................................................................................................................................................................................................................................................................................................................................................................................................@...........
..........................................................................#...............................................................................#................#.......................................................................#.......................................................#.....................................#..................................................@...........
..............#...............^..............#.............#..............#..............#..............#..#.............#...............#^#..............#.............#..#...............#..............^...............#..............^...............#..............#.#..............^...............#.#..............#...#...............#.#..............#.#...............###..................#...........
`;

const level2Pattern = `
..................................................................................................................................................................................................................................................................................................................................................................................................................
..................................................................................................................................................................................................................................................................................................................................................................................................................
..................................................................................................................................................................................................................................................................................................................................................................................................................
..................................................................................................................................................................................................................................................................................................................................................................................................................
......................................................................................................................................................................................................................................................................................................................................................................................................@...........
..........................................................................#............................................#.................................................#...............................................#................#...............................#.....................................................................#.................................................@...........
................#.............#...............#.............#.............#..............#^#............#^#............#...............#.#..............#.#..............#.#.............................#...#.............#.#..............#.#..............#..............#.#..............#..............#...#..............#.#..............#.#..............#.#..............#.#...............###.....@...........
.......^........#......^......#.......^.......#......^......#.......^.....#.......^......###......^.....###......^.....#.#......^......#.#......^.......#.#.......^......#.#.......^.......^......^......#...#......^......#.#......^.......#.#.......^......#......^.......#.#.......^......#.......^......#...#......^.......#.#......^.......#.#......^.......#.#.......^.......###..................#...........
`;

const level3Pattern = `
..................................................................................................................................................................................................................................................................................................................................................................................................................
..................................................................................................................................................................................................................................................................................................................................................................................................................
..................................................................................................................................................................................................................................................................................................................................................................................................................
..................................................................................................................................................................................................................................................................................................................................................................................................................
......................................................................................................................................................................................................................................................................................................................................................................................................@...........
..........................................................................#............................................#.................................................#...............................................#................#...............................#..................................#..................................#..................................................@...........
................#.............#...............#................#..........#..............#.#............#.#............#...............#.#..............#.#..............#.#.............................#...#.............#.#..............#.#..............#..............#.#..............#...#..........#...#..............#.#..............#.#..............#.#...............###..................@...........
.......^........#......^......#.......^.......#.#......^.......#.#........#.......^......#.#......^.....#.#......^.....#.#......^......#.#......^.......#.#.......^......#.#.......^.......^......^......#...#......^......#.#......^.......#.#.......^......#......^.......#.#.......^......#...#..........#...#..............#.#..............#.#..............#.#...............###..................#...........
`;

// Level 4: Rocket Mode
// Unchanged from previous request (Orbital Voyage)
const level4Pattern = `
#########################################################################################################################################################################################################################################################################################################################################################################################################################
.........................................................................................................................................................................................................................................................................................................................................................................................................................
.........................................................................................................................................................................................................................................................................................................................................................................................................................
.........................................................................................................................................................................................................................................................................................................................................................................................................................
.......................................................................................................................................................................................#.............#..............#..............#..............#................#.#................#................#..............#................#.............................................................................
.......................................................................................................................................................................................#.............#..............#..............#..............#................#.#................#................#..............#................#........................................@....................................
.......................................................................................................................................................................................#.............#..............#..............#..............#................#.#................#................#..............#................#........................................@....................................
................................................................................................................................................................................................................................................................................................................................................................................................@....................................
................................................................................................................................................................................................................................................................................................................................................................................................@....................................
..................................................................................................................................................................................................#..............#..............#..............#...........................................................................................#.#................#................#..............#................#..................................................
..................................................................................................................................................................................................#..............#..............#..............#...........................................................................................#.#................#................#..............#................#..................................................
..................................................................................................................................................................................................#..............#..............#..............#...........................................................................................#.#................#................#..............#................#..................................................
`;


export const LEVELS: LevelData[] = [
  createLevel(1, "Stereo Start", "Easy", 8.5, '#4ade80', level1Pattern),
  createLevel(2, "Neon Track", "Medium", 10.5, '#f472b6', level2Pattern),
  createLevel(3, "Midnight Velocity", "Hard", 12.0, '#818cf8', level3Pattern),
  createLevel(4, "Orbital Voyage", "Special", 9.0, '#fbbf24', level4Pattern, 'SHIP'),
];
